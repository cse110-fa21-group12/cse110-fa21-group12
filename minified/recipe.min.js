const deleteButton = document.getElementsByClassName("crud")[2];
deleteButton.addEventListener("click", function () {
  const a = localStorage.getItem("id");
  console.log(a),
    fetch("/recipes/" + a, {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json",
        "Access-Control-Allow-Origin": "*",
        "Access-Control-Allow-Headers": "Content-Type",
        "Access-Control-Allow-Methods": "GET,POST,OPTIONS,DELETE,PUT,PATCH",
      },
    })
      .then((a) => {
        console.log("Success: ", a), (window.location = "recipe-list.html");
      })
      .catch((a) => {
        console.error("Error:", a);
      });
});
const editButton = document.getElementById("edit-button");
editButton.addEventListener("click", function () {
  window.location = "edit-recipe.html";
});
const url = localStorage.getItem("id");
console.log(url),
  fetch("/recipes/" + url, {
    method: "GET",
    headers: {
      "Content-Type": "application/json",
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Headers": "Content-Type",
      "Access-Control-Allow-Methods": "GET,POST,OPTIONS,DELETE,PUT,PATCH",
    },
  })
    .then((a) => a.json())
    .then((a) => {
      console.log("Success:", a);
      const b = document.getElementsByClassName("recipe-title")[0];
      b.innerHTML = a.title;
      const c = document.getElementsByClassName("thumbnail")[0];
      c.setAttribute("src", a.img);
      const d = document.getElementsByClassName("description")[0];
      d.innerHTML = a.description;
      const e = document.getElementById("prep-time");
      e.innerHTML = "Preparation Time: " + a.preparationTime;
      const f = document.getElementById("cook-time");
      f.innerHTML = "Cook Time: " + a.cookingTime;
      const g = document.getElementById("total-time");
      if (
        ((g.innerHTML = "Total Time: " + a.totalTime),
        "spoonacular" == a.creator)
      ) {
        const b = a.ingredients;
        for (let a = 0; a < b.length; a++) {
          const c = b[a].substr(0, b[a].indexOf(" ")),
            d = b[a].substr(b[a].indexOf(" ") + 1),
            e = document.createElement("input");
          e.setAttribute("type", "checkbox"),
            e.setAttribute("id", d),
            e.setAttribute("value", c),
            e.setAttribute("name", "i");
          const f = document.createElement("label");
          f.setAttribute("class", "checklist"),
            f.setAttribute("for", "i"),
            (f.innerHTML = c + " " + d);
          const g = document.createElement("br");
          ingredientsBox.appendChild(e),
            ingredientsBox.appendChild(f),
            ingredientsBox.appendChild(g);
        }
      }
      if ("spoonacular" == a.creator) {
        const b = a.ingredients;
        for (let a = 0; a < b.length; a++) {
          const c = b[a].substr(0, b[a].indexOf(" ")),
            d = b[a].substr(b[a].indexOf(" ") + 1),
            e = document.createElement("input"),
            f = document.getElementById("ingredientsBox");
          e.setAttribute("type", "checkbox"),
            e.setAttribute("id", d),
            e.setAttribute("value", c),
            e.setAttribute("name", "i");
          const g = document.createElement("label");
          g.setAttribute("class", "checklist"),
            g.setAttribute("for", "i"),
            (g.innerHTML = c + " " + d);
          const h = document.createElement("br");
          f.appendChild(e), f.appendChild(g), f.appendChild(h);
        }
      } else {
        const b = Object.keys(a.ingredients),
          c = document.getElementById("ingredientsBox");
        for (let d = 0; d < b.length; d++) {
          const e = document.createElement("input");
          e.setAttribute("type", "checkbox"),
            e.setAttribute("id", b[d]),
            e.setAttribute("value", a.ingredients[b[d]]),
            e.setAttribute("name", "i");
          const f = document.createElement("label");
          f.setAttribute("class", "checklist"),
            f.setAttribute("for", "i"),
            (f.innerHTML = a.ingredients[b[d]] + " " + b[d]);
          const g = document.createElement("br");
          c.appendChild(e), c.appendChild(f), c.appendChild(g);
        }
      }
      const h = document.getElementById("directions");
      for (let b = 1; b < a.directions.length + 1; b++) {
        const c = document.createElement("div");
        c.setAttribute("class", "step");
        const d = document.createElement("h3");
        d.innerHTML = "Step " + b;
        const e = document.createElement("i");
        e.setAttribute("class", "fas fa-utensils"), d.appendChild(e);
        const f = document.createElement("p");
        (f.innerHTML = a.directions[b - 1]),
          c.appendChild(d),
          c.appendChild(f),
          h.appendChild(c);
      }
    })
    .catch((a) => {
      console.error("Error:", a);
    });
const addButton = document.getElementById("add-button");
addButton.addEventListener("click", function () {
  let a,
    b = document.getElementById("ingredientsBox"),
    c = b.getElementsByTagName("input"),
    d = !1;
  console.log(c);
  for (let b = 0; b < c.length; b++)
    "checkbox" == c[b].type &&
      (c[b].checked &&
        ((d = !0), (a = { name: c[b].id, quantity: c[b].value })),
      fetch("/shopping-list", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(a),
      })
        .then((a) => a.json())
        .then((a) => {
          console.log("Success:", a), (location.href = "recipe.html");
        })
        .catch((a) => {
          console.error("Error:", a);
        }));
  !0 == d && alert("Your shopping list has been updated!");
});
