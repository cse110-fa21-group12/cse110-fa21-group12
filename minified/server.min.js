const http=require("http"),Router=require("./router/router"),status=require("./utils/status"),{addProperties}=require("./utils/util"),formidable=require("formidable");class Server extends Router{static get Router(){return Router}static get FormDataParser(){return(a,b,c)=>{try{const b=new formidable.IncomingForm;b.parse(a,async(b,d,e)=>b?c(b):void(a.files=e,a.body=d.hasOwnProperty("json")?JSON.parse(d.json):d,c()))}catch(a){c(a)}}}static get CookiesParser(){return(a,b,c)=>{try{const b={},d=a.headers.cookie;d&&d.split(";").forEach(function(a){let c=a.split("=");b[c.shift().trim()]=decodeURI(c.join("="))}),a.cookies=b,c()}catch(a){c(a)}}}static get JsonParser(){return(a,b,c)=>{if("application/json"!=a.headers["content-type"])return c();let d="";a.on("data",a=>{d+=a.toString()}),a.on("end",()=>{try{a.body=d?JSON.parse(d):{}}catch(b){console.log(`failed parsing as json - ${b}`),a.body=d}c()})}}constructor(){super()}handler(a,b){a&&(addProperties(a,b),this._handle(a,b,a=>{a?(console.log(a),b.writeHead(status.INTERNAL_SERVER_ERROR),b.end("Internal Server Error")):(b.writeHead(status.NOT_FOUND,{"Content-Type":"text/plain"}),b.end(status.NOT_FOUND))}))}listen(a,b){return http.createServer((a,b)=>{addProperties(a,b),this._handle(a,b,a=>{a?(console.log(a),b.writeHead(status.INTERNAL_SERVER_ERROR),b.end("Internal Server Error")):(b.writeHead(status.NOT_FOUND,{"Content-Type":"text/plain"}),b.end(status.NOT_FOUND))})}).listen({port:a},b)}}module.exports=Server;