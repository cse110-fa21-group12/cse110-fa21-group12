function removeRecipes() {
  for (
    const a = document.getElementsByClassName("recipe-list")[0];
    a.hasChildNodes();

  )
    a.removeChild(a.firstChild);
}
function displayRecipes(a) {
  const b = document.getElementById("sort-select").value;
  "short-time" == b
    ? a.sort(function (c, a) {
        return c.totalTime - a.totalTime;
      })
    : "long-time" == b
    ? a.sort(function (c, a) {
        return a.totalTime - c.totalTime;
      })
    : "alphabet" == b &&
      a.sort(function (c, a) {
        return c.title.localeCompare(a.title);
      });
  for (let b = 0; b < a.length; b++) {
    const c = document.getElementsByClassName("recipe-list")[0],
      d = document.createElement("div");
    d.setAttribute("class", "recipe"),
      d.setAttribute("id", a[b].title),
      (d.href = "recipe.html"),
      d.addEventListener("click", function () {
        localStorage.setItem("id", a[b].title),
          (window.location = "recipe.html");
      });
    const e = document.createElement("img");
    e.setAttribute("src", a[b].img), d.appendChild(e);
    const f = document.createElement("p");
    f.setAttribute("class", "recipes-title"),
      (f.innerHTML = a[b].title),
      d.appendChild(f);
    const g = document.createElement("p");
    g.setAttribute("class", "recipe-time"),
      (g.innerHTML =
        '<i class="fas fa-clock">  ' + a[b].totalTime + " minutes"),
      d.appendChild(g),
      c.appendChild(d);
  }
}
function search() {
  const a = document.querySelector(".search").value;
  a && 0 < a.trim().length
    ? (console.log(a),
      removeRecipes(),
      fetch("/search/" + a, {
        method: "GET",
        headers: { "Content-Type": "application/json" },
      })
        .then((a) => a.json())
        .then((a) => {
          console.log("Success:", a), displayRecipes(a);
        }))
    : alert("Please enter a recipe to search!");
}
const searchButton = document.getElementsByClassName("fa fa-search")[0],
  searchText = document.getElementsByClassName("search")[0];
searchText.addEventListener("keypress", function (a) {
  "Enter" == a.key && search();
}),
  searchButton.addEventListener("click", function () {
    search();
  }),
  fetch("/recipes/", {
    method: "GET",
    headers: {
      "Content-Type": "application/json",
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Headers": "Content-Type",
      "Access-Control-Allow-Methods": "GET,POST,OPTIONS,DELETE,PUT,PATCH",
    },
  })
    .then((a) => a.json())
    .then((a) => {
      console.log("Success:", a), displayRecipes(a);
    })
    .catch((a) => {
      console.error("Error:", a);
    });
const logoutButton = document.getElementById("logout-button");
logoutButton.addEventListener("click", function () {
  fetch("/user/sign-out", { method: "GET" })
    .then((a) => a.json())
    .then((a) => {
      console.log("Success:", a);
    })
    .catch((a) => {
      console.error("Error:", a);
    });
});
const deleteAccountButton = document.getElementById("delete-account");
deleteAccountButton.addEventListener("click", function () {
  fetch("/user", { method: "DELETE" })
    .then((a) => a.json())
    .then((a) => {
      console.log("Success:", a);
    })
    .catch((a) => {
      console.error("Error:", a);
    });
});
const selectSort = document.getElementById("sort-select");
selectSort.onchange = function () {
  sortRecipes();
};
function sortRecipes() {
  removeRecipes(),
    fetch("/recipes/", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
        "Access-Control-Allow-Origin": "*",
        "Access-Control-Allow-Headers": "Content-Type",
        "Access-Control-Allow-Methods": "GET,POST,OPTIONS,DELETE,PUT,PATCH",
      },
    })
      .then((a) => a.json())
      .then((a) => {
        console.log("Success:", a), displayRecipes(a);
      })
      .catch((a) => {
        console.error("Error:", a);
      });
}
